<!DOCTYPE html>
<html>
<head>
	<title>Remover Discursiva</title>
</head>
<body>
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $numero = $_POST["numero"];
    $arqDisc = fopen("perguntasdiscursivas.txt", "r") or die("Erro ao abrir o arquivo.");
    $temp = fopen("temp.txt", "w") or die("Erro ao criar arquivo temporário.");
    $encontrado = false;
    $perguntaRemover = "";

    while (!feof($arqDisc)) {
        $linha = fgets($arqDisc);
        $dados = explode(";", $linha);

        if (isset($dados[0]) && $dados[0] == $numero) {
            $encontrado = true;
            $perguntaRemover = $linha;
            continue;
        }

        fwrite($temp, $linha);
    }

    fclose($arqDisc);
    fclose($temp);

    if ($encontrado) {
        if (!isset($_POST["confirmacao"])) {
            echo "<h2>Confirmação de Remoção:</h2>";
            echo "<p>Dados da pergunta a ser removida:</p>";
            echo "<p>$perguntaRemover</p>";
            echo "<form method='POST' action='removerdados_discursiva.php'>";
            echo "<input type='hidden' name='numero' value='$numero'>";
            echo "<input type='hidden' name='confirmacao' value='true'>";
            echo "<input type='submit' value='Confirmar Remoção' name='remover'>";
            echo "</form>";
            echo "<form action='index_logado.php'>";
            echo "<br><br>";
            echo "<input type='submit' value='Cancelar'>";
            echo "</form>";
        } else {
            $arqDisc = fopen("perguntasdiscursivas.txt", "w") or die("Erro ao abrir o arquivo.");
            fwrite($arqDisc, file_get_contents("temp.txt"));
            fclose($arqDisc);
            unlink("temp.txt");
            echo "<h2>Pergunta removida com sucesso.</h2>";
        }
    } else {
        echo "<h2>Pergunta não encontrada.</h2>";
    }
}
?>

<form method="POST" action="removerdados_discursiva.php">
    <h2>Remover pergunta:</h2>
    <label for="numero">Número da pergunta:</label>
    <input type="text" name="numero" id="numero" required>
    <input type="submit" value="Remover" name="remover">
</form>

<form action="index_logado.php">
    <br>
    <br>
    <input type="submit" value="Voltar ao menu principal">
</form>

</body>
</html>
